var INITIALIZERNOP = [
  "Ym05dw=="
]

var INITIALIZER1 = [
  "VHlCeWIyTER0Q0JrWlhabElITnBibUZzYVhwaGNpQXpJSFpsZW1WeklIRjFZVzVrYnlCbGJtTnZiblJ5WVhJZ2RXMGdiMkp6ZE1PaFkzVnNienM9",
  "VHlCeWIyTER0Q0JrWlhabElITnBibUZzYVhwaGNpQndiM0lnTVRBZ2MyVm5kVzVrYjNNc0lHRnVkR1Z6SUdSbElHbHVhV05wWVhJZ1lTQnliMlJoWkdFc0lHUmxJR1p2Y20xaElHRjFkRzl0dzZGMGFXTmhMaUJQZFNCelpXcGhMQ0JoYnlCelpYSWdiR2xuWVdSdkxDQnZJSEp2WXNPMElIWmhhU0J6YVc1aGJHbDZZWElnWlNCa1pYQnZhWE1nYVc1cFkybGhjaUJoSUhKdlpHRmtZVHM9",
  "SWtSaGJzT25ZWElpSUM4Z0lsUnlaVzFsY2lJZ0x5QWlWbWxpY21GeUlpQXZJQ0pHYVdOaGNpQnBibVJ2SUdVZ2RtOXNkR0Z1Wkc4aUlHRnVkR1Z6SUdSbElHbHVhV05wWVhJZ1lTQnliMlJoWkdFPQ==",
  "VHlCeWIyTER0Q0JrWlhabElITnBibUZzYVhwaGNpQmhieUJwYm1samFXRnlJR0VnY205a1lXUmhPdz09",
  "VW1WemIyeDJZU0J2SUhCeWIySnNaVzFoT2lCVFpTQjFiU0J5YjJMRHRDQjBaVzBnTXpBZ2NHRnlZV1oxYzI5eklHVWdjR1Z5WkdWMUlESXdMQ0J4ZFdGdWRHOXpJSEJoY21GbWRYTnZjeUJ6YjJKeVlYSmhiVDhnVTJsdVlXeHBlbVVnYnlCdXc3cHRaWEp2SUdSbElIWmxlbVZ6SUdsbmRXRnNJR0VnY1hWaGJuUnBaR0ZrWlNCa1lTQnpiMkp5WVNCa2IzTWdjR0Z5WVdaMWMyOXpJR0Z2SUdWdVkyOXVkSEpoY2lCMWJTQnZZbk4wdzZGamRXeHZPdz09",
  "UVc4Z1kyaGxaMkZ5SUc1aElNT2hjbVZoSUdSbElISmxjMmRoZEdVc0lHOGdjbTlpdzdRZ2FYTERvU0J6YVc1aGJHbDZZWEk3",
  "VW05aXc3UWdaR1YyWlNCMmIyeDBZWElnWlNCcGNpQndZWEpoSUdaeVpXNTBaU0J3Wld4dklHMWxibTl6SURJZ2RtVjZaWE1nWVc4Z1pHVjBaV04wWVhJZ2RXMGdiMkp6ZE1PaFkzVnNienM9",
  "VW05aXc3UWdaR1YyWlNCa1lYSWdkVzBnWjJseWJ5QmpiMjF3YkdWMGJ5QmxiU0J6WlhVZ2NITERzM0J5YVc4Z1pXbDRieUJsYlNCeGRXRnNjWFZsY2lCdGIyMWxiblJ2SUdSaElISnZaR0ZrWVRzPQ==",
  "VHlCeWIyTER0Q0JrWlhabElITnBibUZzYVhwaGNpQXlJSFpsZW1WeklHRnZJR1JsYzNacFlYSWdaR1VnZFcwZ2IySnpkTU9oWTNWc2J5ND0=",
  "VTJsdVlXeHBlbUZ5SUhSdlpHRnpJR0Z6SUhabGVtVnpJSEYxWlNCdklISnZZc08wSUdWdVkyOXVkSEpoY2lCbGJtTnlkWHBwYkdoaFpHRnpJR052YlNCaElIQnlaWE5sYnNPbllTQmtZU0JwYm1ScFkySERwOE9qYnlCMlpYSmtaU3dnY0dGeVlTQmhJR1JwY21WcGRHRWdiM1VnWlhOeGRXVnlaR0V1",
  "UlhVZ1kyOXRjSEpsYVNBMU1DQmlZWFJsY21saGN5NGdWWE5sYVNBek1DQmxJR1JsYVNBeE5TQndZWEpoSUcxbGRTQnBjbTNEbzI4dUlGRjFZVzUwWVhNZ1ltRjBaWEpwWVhNZ2MyOWljbUZ5WVcwL0lGTnBibUZzYVhwbElHRWdjWFZoYkhGMVpYSWdiVzl0Wlc1MGJ5QnVieUJ5YjNWdVpDQmhJSEYxWVc1MGFXUmhaR1VnWkdVZ2RtVjZaWE1nWkc4Z2JzTzZiV1Z5YnlCa1pTQmlZWFJsY21saGN5QnhkV1VnYzI5aWNtRnlZVzB1",
  "UlcwZ2NHVnNieUJ0Wlc1dmN5QjFiU0J2WW5OMHc2RmpkV3h2TENCaGJ5QmtaWFJsWTNURG9TMXNieXdnYnlCeWIyTER0Q0JrWlhabElIQmhjbUZ5SUhCdmNpQTFJSE5sWjNWdVpHOXpMQ0J6YVc1aGJHbDZZWElnWlNCa1pYQnZhWE1nYzNWd1pYSmhjaUJ2SUc5aWMzVERvV04xYkc4PQ=="
]

var INITIALIZER2 = [
  "TVM0Z0lDSkVZVzdEcDJGeUlpQXZJQ0pVY21WdFpYSWlJQzhnSWxacFluSmhjaUlnTHlBaVJtbGpZWElnYVc1a2J5QmxJSFp2YkhSaGJtUnZJaUJoYm5SbGN5QmtaU0JwYm1samFXRnlJR0VnY205a1lXUmhPdz09",
  "TWk0Z0lFTnZiblpsY25SaElHOGdic082YldWeWJ5QXdNREF3SURBd01URWdaR1VnWW1sdXc2RnlhVzhnY0dGeVlTQmtaV05wYldGc0xpQlBJSEpsYzNWc2RHRmtieUREcVNCdklHN0R1bTFsY204Z1pHVWdkbVY2WlhNZ2NYVmxJRzhnY205aXc3UWdkbUZwSUhOcGJtRnNhWHBoY2lCeGRXRnVaRzhnZFcwZ2IySnpkTU9oWTNWc2J5QmxibU52Ym5SeVlYSTdJQT09",
  "TXk0Z0lFOGdjbTlpdzdRZ1pHVjJaU0J1YnlCcGJzT3RZMmx2SUdSaElISnZaR0ZrWVNCMWMyRnlJRzhnYzJsdVlXeHBlbUZrYjNJZ2NHOXlJSEJsY3NPdGIyUnZjeUJzYjI1bmIzTWdaU0JqZFhKMGIzTWdjR0Z5WVNCemFXNWhiR2w2WVhJZ2J5Qmp3N05rYVdkdklHSnBic09oY21sdklERXdNVEF1SUU5MUlITmxhbUU2SUhOcGJtRnNhWHBodzZmRG8yOGdiRzl1WjJFc0lHUmxjRzlwY3lCamRYSjBZU3dnWkdWd2IybHpJR3h2Ym1kaExDQmtaWEJ2YVhNZ1kzVnlkR0VnYm05MllXMWxiblJsT3c9PQ==",
  "TkM0Z0lGVnRJR0Z1ZEdWd1lYSnZMMjlpYzNURG9XTjFiRzhnYzJWeXc2RWdZMjlzYjJOaFpHOGdibUVnWm5KbGJuUmxJR1J2SUhKdllzTzBJR0Z1ZEdWeklHUnZJR2x1dzYxamFXOGdaR0VnY205a1lXUmhMaUJQSUhKdllzTzBJR1JsZG1WeXc2RWdjMmx1WVd4cGVtRnlJR1Z1Y1hWaGJuUnZJRzhnYjJKemRNT2hZM1ZzYnlCbGMzUnBkbVZ5SUc1aElHWnlaVzUwWlNCa2J5QnliMkxEdEM0Z1FYRERzM01nY21WdGIzWmxjaUJ2SUc5aWMzVERvV04xYkc4c0lHOGdjbTlpdzdRZ1pHVjJaWExEb1NCd1lYSmhjaUJrWlNCemFXNWhiR2w2WVhJZ1pTQnBibWxqYVdGeUlHRWdjbTlrWVdSaExpQkZjM1JoY3lCaHc2ZkR0V1Z6SUdSbGRtVnRJRzlqYjNKeVpYSWdaR1VnWm05eWJXRWdZWFYwYjIzRG9YUnBZMkU3SUE9PQ==",
  "TlM0Z0lFVnRJSEJsYkc4Z2JXVnViM01nZFcwZ2IySnpkTU9oWTNWc2J5d2dZVzhnWkdWMFpXTjB3NkV0Ykc4c0lHOGdjbTlpdzdRZ1pHVjJaU0J3WVhKaGNpQndiM0lnTlNCelpXZDFibVJ2Y3l3Z2MybHVZV3hwZW1GeUlHVWdaR1Z3YjJseklITjFjR1Z5WVhJZ2J5QnZZbk4wdzZGamRXeHZMZz09",
  "Tmk0Z0lFRnd3N056SUhCaGMzTmhjaUJ3YjNJZ2RXMGdiMkp6ZE1PaFkzVnNieXdnYnlCeWIyTER0Q0JrWlhabElITnBibUZzYVhwaGNpQmhieUIyYjJ4MFlYSWdjR0Z5WVNCaElHeHBibWhoT3c9PQ==",
  "Tnk0Z0lFVnRJSEYxWVd4eGRXVnlJRzF2YldWdWRHOHNJRzhnY205aXc3UWdaR1YyWlNCd1lYSmhjaXdnWkdGeUlIVnRJR2RwY204Z1pHVWdNell3SUdkeVlYVnpJR1VnWkdGeUlIVnRZU0RpZ0p4ellXMWlZV1JwYm1oaDRvQ2RMZz09",
  "T0M0Z0lGSmxjMjlzZG1FZ1lTQnpaV2QxYVc1MFpTQmxjWFZodzZmRG8yODZJSGpDc2lEaWdKTWdOWGdnS3lBMklEMGdNQzRnVTJVZ1lTQnlaWE53YjNOMFlTQm1iM0lnYldWdWIzSWdjWFZsSUdSdklEVXNJRzhnY205aXc3UWdaR1YyWlNCa1lYSWdkVzBnWjJseWJ5QndZWEpoSUdFZ1pYTnhkV1Z5WkdFZ1lYTnphVzBnY1hWbElHWnZjaUJwYm1samFXRmtieUJ2SUhKdmRXNWtMQ0J6WlNCaElISmxjM0J2YzNSaElHWnZjaUJ0WVdsdmNpQmtieUJ4ZFdVZ05TQnZJSEp2WXNPMElHUmxkbVVnWkdGeUlIVnRJR2RwY204Z2NHRnlZU0JoSUdScGNtVnBkR0VnWVc4Z2FXNXBZMmxoY2lCdklISnZkVzVrTGc9PQ==",
  "T1M0Z0lFOGdjbTlpdzdRZ1pHVjJaU0J6YVc1aGJHbDZZWElnZFcxaElIWmxlaUIwYjJSaElIWmxlaUJ4ZFdVZ2JHOWpZV3hwZW1GeUlIVnRZU0IydzYxMGFXMWhMZz09",
  "TVRBdUlFOGdjbTlpdzdRZ1pHVjJaU0J3WVhKaGNpQndiM0lnTXlCelpXZDFibVJ2Y3lCMGIyUmhJSFpsZWlCeGRXVWdiRzlqWVd4cGVtRnlJSFZ0WVNCMnc2MTBhVzFoTGc9PQ==",
  "TVRFdUlFTmhiR04xYkdVZ1lTQnR3NmxrYVdFZ1lYSnBkRzNEcVhScFkyRWdjMmx0Y0d4bGN5QmtiM01nYnNPNmJXVnliM002SURFMUlEc2dORGdnT3lBek5pNGdRMkZ6YnlCaElISmxjM0J2YzNSaElITmxhbUVnYldWdWIzSWdjWFZsSURJd0lHOGdjbTlpdzdRZ1pHVjJaU0JtWVhwbGNpQjFiU0J0YjNacGJXVnVkRzhnY0dGeVlTQmhJR1JwY21WcGRHRWdZVzUwWlhNZ1pHVWdZMjl0WmNPbllYSWdieUJ5YjNWdVpDd2djMlVnWm05eUlHMWhhVzl5SUhGMVpTQXlNQ0J2SUhKdllzTzBJR1JsZG1VZ1ptRjZaWElnZFcwZ2JXOTJhVzFsYm5SdklIQmhjbUVnWVNCbGMzRjFaWEprWVNCaGJuUmxjeUJrWlNCamIyMWx3NmRoY2lCdklISnZkVzVrTGc9PQ==",
  "TVRJdUlFRWdkSFZ5YldFZ1pHOGdOc0s2SUdGdWJ5QkJJR1JsSUhWdFlTQmtaWFJsY20xcGJtRmtZU0JsYzJOdmJHRWdkR1Z0SURJMUlHRnNkVzV2Y3l3Z1pHOXpJSEYxWVdseklESTBKU0J6dzZOdklHMWxibWx1YjNNdUlGRjFZVzUwYjNNZ2JXVnVhVzV2Y3lCMFpXMGdibUVnZEhWeWJXRWdaRzhnTnNLNklHRnVieUJCUHlCRFlYTnZJR0VnY21WemNHOXpkR0VnYzJWcVlTQnRaVzV2Y2lCeGRXVWdNVEFnYzJsdVlXeHBlbVVnWlc1eGRXRnVkRzhnYzI5aVpTQmhJSEpoYlhCaExDQmpZWE52SUhObGFtRWdiV0ZwYjNJZ2NYVmxJREV3SUhOcGJtRnNhWHBsSUdWdElIUnZaRzhnYnlCMGNtRnFaWFJ2SUdSaElNT2hjbVZoSUdSbElIQmxjbU4xY25OdkxDQnRaVzV2Y3lCdVlTQnlZVzF3WVE9PQ==",
  "TVRNdUlFTnZiWEJ5WldrZ2RXMGdiVzkwYjNJZ2JtOTJieUJ3WVhKaElHMWxkU0J5YjJMRHRDQmxJRzlpZEdsMlpTQjFiU0JrWlhOamIyNTBieUJrWlNBeE5TVWdjRzl5SUhCaFoyRnlJR0VnZG1semRHRXVJRk5sSUhCaFozVmxhU0JTSkRFd01pd3dNQ0J3Wld4dklHMXZkRzl5TENCeGRXRnNJR1Z5WVNCelpYVWdjSEpsdzZkdklHOXlhV2RwYm1Gc0lITmxiU0J2SUdSbGMyTnZiblJ2UHlCVFpTQnZJSFpoYkc5eUlHWnZjaUJ0WVdsdmNpQnhkV1VnVWlReE1UQXNNREFnYzJsdVlXeHBlbVVnY1hWaGJtUnZJR05vWldkaGNpQnVZU0REdW14MGFXMWhJSE5oYkdFc0lITmxJRzhnZG1Gc2IzSWdabTl5YlNCdFpXNXZjaUJ4ZFdVZ1VpUXhNVEFzTURBZ2NHRnlaU0J3YjNJZ01pQnpaV2QxYm1SdmN5QnhkV0Z1Wkc4Z1kyaGxaMkZ5SUc1aElNTzZiSFJwYldFZ2MyRnNZUzQ9",
  "TVRRdUlGUnl3NnB6SUdKeVljT25iM01nY205aXc3TjBhV052Y3lCMGNtRnVjM0J2Y25SaGJTQXlNREFnZEc5dVpXeGhaR0Z6SUdSbElIQnliMlIxZEc5eklIQnZjaUJrYVdFdUlGQmhjbUVnZEhKaGJuTndiM0owWVhJZ01UWXdNQ0IwYjI1bGJHRmtZWE1nY0c5eUlHUnBZU3dnY1hWaGJuUnZjeUJpY21IRHAyOXpJSEp2WXNPemRHbGpiM01nYzJWeWFXRnRJRzVsWTJWemM4T2hjbWx2Y3o4Z1EyRnpieUJoSUhKbGMzQnZjM1JoSUhObGFtRWdiV1Z1YjNJZ2NYVmxJREUxSUhOcGJtRnNhWHBsSUc1dklHbHV3NjFqYVc4Z1pHRWdjbTlrWVdSaExDQmpZWE52SUdFZ2NtVnpjRzl6ZEdFZ2MyVnFZU0J0WVdsdmNpQnhkV1VnTVRVZ2NHRnlaU0J3YjNJZ05TQnpaV2QxYm1SdmN5QnhkV0Z1Wkc4Z1pXNWpiMjUwY21GeUlIVnRJRzlpYzNURG9XTjFiRzhzSUdGdWRHVnpJR1JsYkdVZ2NtVmhiR2w2WVhJZ2J5QmtaWE4yYVc4dQ==",
  "TVRVdUlGVnRJRzlwZEdGMmJ5QmtaU0IxYldFZ2NHbDZlbUVnWTNWemRHRWdVaVF6TERBd0xpQlJkV0Z1ZEc4Z1kzVnpkR0VnZFcxaElIQnBlbnBoSUdsdWRHVnBjbUUvSUZObElHWnZjaUJ0Wlc1dmNpQnhkV1VnVWlReU1Dd3dNQ0J2SUhKdllzTzBJR1JsZG1WeXc2RWdjMmx1WVd4cGVtRnlJSFJ2WkdGeklHRnpJSFpsZW1WeklIRjFaU0IwYVhabGNpQjFiV0VnWlc1amNuVjZhV3hvWVdSaElHTnZiU0IyWlhKa1pTQmhJR1JwY21WcGRHRXNJSE5sSUdadmNpQnRZV2x6SUhGMVpTQlNKREl3TERBd0lHOGdjbTlpdzdRZ1pHVjJaWExEb1NCemFXNWhiR2w2WVhJZ2RHOWtZWE1nWVhNZ2RtVjZaWE1nY1hWbElHOGdjbTlpdzdRZ1pYTjBhWFpsY2lCdWRXMWhJR1Z1WTNKMWVtbHNhR0ZrWVNCamIyMGdkbVZ5WkdVZ2NHRnlZU0JoSUdWemNYVmxjbVJoTGlBPQ==",
  "TVRZdUlGTnBibUZzYVhwaGNpQjBiMlJoY3lCaGN5QjJaWHBsY3lCeGRXVWdieUJ5YjJMRHRDQmxibU52Ym5SeVlYSWdaVzVqY25WNmFXeG9ZV1JoY3lCamIyMGdZU0J3Y21WelpXN0RwMkVnWkdFZ2FXNWthV05odzZmRG8yOGdkbVZ5WkdVc0lIQmhjbUVnWVNCa2FYSmxhWFJoSUc5MUlHVnpjWFZsY21SaExnPT0="
]

var Tokens={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Tokens._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9+/=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Tokens._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/rn/g,"n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}

angular.module('Desafio', [])

.controller('DesafioCtrl', function ($scope, Table, Score) {
  $scope.tables = Table.all()
  $scope.selectedTable = null
  $scope.selectedScore = null
  $scope.tableScores = null

  $scope.error = null
  $scope.search = ''

  $scope.selectTable = function selectTable(table) {
    $scope.error = ''
    $scope.selectedTable = table
    $scope.selectedScore = null
  }

  $scope.selectScore = function selectScore(score) {
    $scope.error = ''
    $scope.selectedScore = score
  }

  $scope.generateChallenge = function generateChallenge(score, challengeId) {
    $scope.error = ''
    
    var teamName = score.team && score.team.name
    if (!teamName) {
      $scope.error = 'O nome desta equipe não está definido, verifique se a equipe possui um nome válido'
      return 
    }

    // Checa nivel
    var teamNivel = null
    if (teamName[0] == '1') teamNivel = 1
    else if (teamName[0] == '2') teamNivel = 2
    else {
      $scope.error = 
        'Não foi possível identificar o nível a partir do nome da equipe. \n' + 
        'Use o formato "1 - equipe" ou "2 - equipe" para indicar o nível 1 ou 2.'
      return
    }
    
    var msg = 'Tem certeza de que deseja gerar o desafio ' + 
              challengeId + ' da equipe ' + (teamName) + '?'

    var ok = confirm(msg)

    if (!ok) {
      return
    }

    var possibleChallenges = _.without(window['DES' + teamNivel], score.desafio1)
    var challenge = _.sample(possibleChallenges)

    var newChallenges = {
      id: score.id,
    }

    newChallenges['desafio'+challengeId] = challenge

    Score.update(newChallenges, function (score){ 
      $scope.selectedScore.desafio1 = score.desafio1
      $scope.selectedScore.desafio2 = score.desafio2
      $scope.selectedScore.desafio3 = score.desafio3
    }, function () {
      $scope.error = 'Falha ao gerar scores'
    })

    console.log(challenge)
  }

  function initUI(){
    var z = 'ial', d = 'izer', a = 'init', cas = 'AF', main = 'IOS', upper = 'DES'
    // window[(a + z + d).toUpperCase()]['map'](function (e){console.log(Tokens.encode(Tokens.encode(e)))})
    window[upper+1] = window[(a + z + d + 1).toUpperCase()]['map'](function (e){return Tokens.decode(Tokens.decode(e))})
    window[upper+2] = window[(a + z + d + 2).toUpperCase()]['map'](function (e){return Tokens.decode(Tokens.decode(e))})
  }; initUI()
})

function makeAll(chals) {
  chals = chals.map(function (e) { return Tokens.encode(Tokens.encode(e)) })
  return JSON.stringify(chals, null, 2)
}